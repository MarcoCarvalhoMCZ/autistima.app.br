@model ApplicationUser
@{
    ViewData["Title"] = "Detalhes do Usuário";
}

<div class="container-fluid py-4">
    <div class="row">
        <div class="col-lg-4">
            <!-- Card de Perfil -->
            <div class="card border-0 shadow-sm mb-4">
                <div class="card-body text-center">
                    <div class="bg-salmon-light rounded-circle d-inline-flex align-items-center justify-content-center mb-3" style="width: 80px; height: 80px;">
                        <i class="bi bi-person-fill fs-1 text-salmon"></i>
                    </div>
                    <h5 class="mb-1">@Model.NomeCompleto</h5>
                    <p class="text-muted mb-2">@Model.Email</p>
                    <span class="badge @(Model.TipoPerfil == TipoPerfil.Administrador ? "bg-danger" : "bg-secondary") mb-3">
                        @Model.TipoPerfil
                    </span>
                    
                    <hr>
                    
                    <div class="text-start">
                        <p class="mb-2">
                            <i class="bi bi-geo-alt me-2 text-muted"></i>
                            @(Model.Cidade ?? "Não informado") @(Model.Estado != null ? $"/ {Model.Estado}" : "")
                        </p>
                        <p class="mb-2">
                            <i class="bi bi-calendar me-2 text-muted"></i>
                            Cadastro: @Model.DataCadastro.ToString("dd/MM/yyyy HH:mm")
                        </p>
                        <p class="mb-0">
                            <i class="bi bi-circle-fill me-2 @(Model.Ativo ? "text-success" : "text-danger")"></i>
                            @(Model.Ativo ? "Ativo" : "Inativo")
                        </p>
                    </div>
                </div>
                <div class="card-footer bg-transparent">
                    <div class="d-grid gap-2">
                        <a asp-action="Edit" asp-route-id="@Model.Id" class="btn btn-outline-primary">
                            <i class="bi bi-pencil me-2"></i>Editar
                        </a>
                        <form asp-action="ResetSenha" asp-route-id="@Model.Id" method="post" 
                              onsubmit="return confirmarAcao(this, 'Resetar Senha', 'Deseja resetar a senha deste usuário?', 'Resetar');">
                            @Html.AntiForgeryToken()
                            <button type="submit" class="btn btn-outline-warning w-100">
                                <i class="bi bi-key me-2"></i>Resetar Senha
                            </button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="col-lg-8">
            <!-- Estatísticas do usuário -->
            <div class="row g-3 mb-4">
                <div class="col-md-3">
                    <div class="card border-0 shadow-sm h-100">
                        <div class="card-body text-center">
                            <h3 class="mb-0">@Model.Filhos.Count</h3>
                            <small class="text-muted">Filhos</small>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="card border-0 shadow-sm h-100">
                        <div class="card-body text-center">
                            <h3 class="mb-0">@Model.Posts.Count</h3>
                            <small class="text-muted">Posts</small>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="card border-0 shadow-sm h-100">
                        <div class="card-body text-center">
                            <h3 class="mb-0">@Model.Manejos.Count</h3>
                            <small class="text-muted">Manejos</small>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="card border-0 shadow-sm h-100">
                        <div class="card-body text-center">
                            <h3 class="mb-0">@Model.Servicos.Count</h3>
                            <small class="text-muted">Serviços</small>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Filhos Registrados -->
            @if (Model.Filhos != null && Model.Filhos.Any())
            {
                <div class="card border-0 shadow-sm mb-4">
                    <div class="card-header bg-transparent d-flex justify-content-between align-items-center">
                        <h6 class="mb-0">Filhos Registrados (@Model.Filhos.Count)</h6>
                    </div>
                    <div class="table-responsive">
                        <table class="table table-hover mb-0">
                            <thead class="table-light">
                                <tr>
                                    <th>Nome</th>
                                    <th>Data de Nascimento</th>
                                    <th>Diagnóstico</th>
                                    <th>Escola</th>
                                </tr>
                            </thead>
                            <tbody>
                                @foreach (var filho in Model.Filhos)
                                {
                                    <tr>
                                        <td>@filho.Nome</td>
                                        <td>@(filho.DataNascimento?.ToString("dd/MM/yyyy") ?? "-")</td>
                                        <td>@(filho.NivelSuporte.HasValue ? filho.NivelSuporte.Value.ToString() : (filho.PossuiDiagnostico ? "Sim" : "Em análise"))</td>
                                        <td>@(filho.Escola?.Nome ?? "-")</td>
                                    </tr>
                                }
                            </tbody>
                        </table>
                    </div>
                </div>
            }

            <!-- Informações adicionais -->
            <div class="card border-0 shadow-sm">
                <div class="card-header bg-transparent">
                    <h6 class="mb-0">Informações Adicionais</h6>
                </div>
                <div class="card-body">
                    <dl class="row mb-0">
                        @if (!string.IsNullOrEmpty(Model.PhoneNumber))
                        {
                            <dt class="col-sm-4">Telefone</dt>
                            <dd class="col-sm-8">@Model.PhoneNumber</dd>
                        }
                        
                        @if (!string.IsNullOrEmpty(Model.SobreMim))
                        {
                            <dt class="col-sm-4">Sobre</dt>
                            <dd class="col-sm-8">@Model.SobreMim</dd>
                        }
                        
                        @if (Model.TipoPerfil == TipoPerfil.Empresa)
                        {
                            <dt class="col-sm-4">Empresa</dt>
                            <dd class="col-sm-8">@(Model.NomeEmpresa ?? "-")</dd>
                            
                            <dt class="col-sm-4">CNPJ</dt>
                            <dd class="col-sm-8">@(Model.CNPJ ?? "-")</dd>
                            
                            <dt class="col-sm-4">Empresa Amiga</dt>
                            <dd class="col-sm-8">@(Model.EmpresaAmiga ? "Sim ✅" : "Não")</dd>
                        }
                        
                        @if (Model.TipoPerfil == TipoPerfil.ProfissionalSaude || Model.TipoPerfil == TipoPerfil.ProfissionalEducacao)
                        {
                            <dt class="col-sm-4">Especialidade</dt>
                            <dd class="col-sm-8">@(Model.Especialidade?.Nome ?? "-")</dd>
                            
                            <dt class="col-sm-4">Registro</dt>
                            <dd class="col-sm-8">@(Model.RegistroProfissional ?? "-")</dd>

                            <dt class="col-sm-4">Matrícula</dt>
                            <dd class="col-sm-8">@(Model.MatriculaProfissional ?? "-")</dd>
                        }
                        
                        <dt class="col-sm-4">Email Confirmado</dt>
                        <dd class="col-sm-8">@(Model.EmailConfirmed ? "Sim ✅" : "Não ❌")</dd>
                    </dl>
                </div>
            </div>
        </div>
    </div>
    
    <div class="mt-4">
        <a asp-action="Index" class="btn btn-outline-secondary">
            <i class="bi bi-arrow-left me-2"></i>Voltar à lista
        </a>
    </div>
</div>
